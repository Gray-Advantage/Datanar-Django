# [Datanar](https://datanar.ru) - .env файл

> Это инструкция, которая распишет каждую настройку в файле `.env`, приятного 
> чтения!

---

## Содержание
- [Настройки для Docker](#настройки-для-docker)
  - [COMPOSE_PROFILES](#compose_profiles)
- [Основные настройки Django](#основные-настройки-django)
  - [DATANAR_DJANGO_DEBUG](#datanar_django_debug)
  - [DATANAR_SECRET_KEY](#datanar_secret_key)
  - [DATANAR_LOG_FILE_PATH]()
  - [DATANAR_ALLOWED_HOSTS](#datanar_allowed_hosts)
- [Почтовый сервис](#почтовый-сервис)
  - [DATANAR_MAIL_HOST](#datanar_mail_host)
  - [DATANAR_MAIL_PORT](#datanar_mail_port)
  - [DATANAR_MAIL_USER](#datanar_mail_user)
  - [DATANAR_MAIL_PASSWORD](#datanar_mail_password)
- [Пользователи и суперпользователь](#пользователи-и-суперпользователь)
  - [DATANAR_DEFAULT_USER_IS_ACTIVE](#datanar_default_user_is_active)
  - [DATANAR_SUPERUSER_NAME](#datanar_superuser_name)
  - [DATANAR_SUPERUSER_EMAIL](#datanar_superuser_email)
  - [DATANAR_SUPERUSER_PASSWORD](#datanar_superuser_password)
- [База данных](#база-данных)
  - [DATANAR_USE_FILE_DATABASE](#datanar_use_file_database)
  - [DATANAR_DATABASE_NAME](#datanar_database_name)
  - [DATANAR_DATABASE_USER](#datanar_database_user)
  - [DATANAR_DATABASE_PASSWORD](#datanar_database_password)
  - [DATANAR_DATABASE_HOST](#datanar_database_host)
  - [DATANAR_DATABASE_PORT](#datanar_database_port)
- [Redis](#redis)
  - [DATANAR_REDIS_HOST](#datanar_redis_host)
  - [DATANAR_REDIS_PORT](#datanar_redis_port)
  - [DATANAR_REDIS_DB](#datanar_redis_db)
- [Certbot](#certbot)
  - [DATANAR_CERTBOT_DEBUG](#datanar_certbot_debug)
  - [DATANAR_CERTBOT_STAGING](#datanar_certbot_staging)
  - [DATANAR_CERTBOT_EMAIL](#datanar_certbot_email)

---

## Настройки для Docker
### COMPOSE_PROFILES
- Docker compose имеет профили. В зависимости от них он может запускать только 
часть контейнеров. Принимает два возможных значения:
  - `dev` - помимо всех остальных контейнеров запускает только nginx-dev, 
    который обрабатывает только порт 80 (http), во время локальной разработки
    использовать **ТОЛЬКО** его
  - `prod` - помимо всех остальных контейнеров запускает только nginx-prod,
    который обрабатывает 80 и 443 порты (http и https соответственно). На борту
    имеет certbot, который при запуске проверяет SSL сертификаты и создаёт /
    обновляет их в случае необходимости. Во время локальной разработки **НЕ**
    использовать его, так как с локальной машины (у которой нет доменного
    имени) проверка подлинности сертификатов невозможна, а при слишком частом
    обращении в центр сертификации можно получить блокировку
 
---

## Основные настройки Django
### DATANAR_DJANGO_DEBUG
- Отладочный режим работы django приложения, имеет два возможных значения:
  - `True` - Если во время работы приложения произойдёт ошибка, то весь её лог
    будет отображён пользователю, удобен во время разработки, но может быть 
    опасен при развёртывании на реальном сервере
  - `False` - Ошибки не будут показаны пользователю (вместо этого будет 
    выведена красивая страница), также в этом режиме django не раздаёт статику,
    поэтому, если проект развёрнут в [нативном режиме](native-install.md), css
    и js файлы не будут переданы в браузер, используйте 
    [nginx](https://nginx.org/ru/), или настройте [docker](docker-install.md),
    или просто установите значение в `True`

### DATANAR_SECRET_KEY
- Это большое случайное число, применяемое для защиты от CSRF в основном
используется для подписи сеансовых файлов cookie. Важно, чтобы ключ, 
используемый в продакшене, не указывался в исходном коде, и/или не запрашивался
с другого сервера. Просто сгенерируйте большую последовательность и храните её
в секрете

### DATANAR_LOG_FILE_PATH
- Путь до файла, в который django будет записывать все возникшие ошибки, если 
используете [нативную установку](native-install.md), можете писать почти любое
место, если же используете [контейнеризацию](docker-install.md), то 
**НЕ МЕНЯЙТЕ**, так как контейнеры подвязаны к значению по умолчанию

### DATANAR_ALLOWED_HOSTS
- Список строк, перечисленных через запятую, представляющих имена хостов /
доменов, которые может обслуживать данный сайт. Это мера безопасности для
предотвращения [HTTP Host header атак](https://django.fun/docs/django/5.0/topics/security/#host-headers-virtual-hosting),
которые возможны даже при многих, казалось бы, безопасных конфигурациях
веб-серверов. Пока идёт разработка, можно оставить по умолчанию `*`, иначе 
укажите все доменные имена вашего сайта, например `datanar.ru,www.datanar.ru`

---

## Почтовый сервис
### DATANAR_MAIL_HOST
- Имя SMTP-хоста для отправки электронных писем, по умолчанию используется
сервис mail.ru и его SMTP-сервер `smtp.mail.ru`, но можно использовать и 
другие, например 
### DATANAR_MAIL_PORT
- Порт соединения с SMTP-сервером, несмотря на то, что в 
[документации](https://help.mail.ru/mail/mailer/popsmtp/) указан порт `465`, в 
реальности работает `2525` ¯\\\_(ツ)_/¯
### DATANAR_MAIL_USER
- Логин пользователя, от имени которого будет отправляться почта, на самом 
сайте [datanar](https://datanar.ru) почтовый робот `datanar_email_bot@mail.ru`.
Будьте внимательны, если получаете письмо, от других, но похожих пользователей
### DATANAR_MAIL_PASSWORD
- Пароль для пользователя, от имени которого будет отправляться почта. Обычно
пароль для SMTP отличается от пароля для обычного входа на почту, внимательно
прочтите инструкцию к своему SMTP-серверу

---

## Пользователи и суперпользователь
### DATANAR_DEFAULT_USER_IS_ACTIVE
- Это параметр определяет, является ли пользователь после регистрации
активированным или нет, т.е. требуется ли ему подтверждать введённую почту или
нет. Имеет два возможных значения:
  - `True` - Пользователь уже активирован, подтверждать почту не требуется
  - `False` - Пользователь не активирован, требуется подтверждать почту
### DATANAR_SUPERUSER_NAME
- **Логин** суперпользователя, который имеет больше возможностей,
чем обычные пользователи
### DATANAR_SUPERUSER_EMAIL
- **Почта** суперпользователя с логином 
[`DATANAR_SUPERUSER_NAME`](#datanar_superuser_name), который имеет больше 
возможностей, чем обычные пользователи
### DATANAR_SUPERUSER_PASSWORD
- **Пароль** суперпользователя с логином
[`DATANAR_SUPERUSER_NAME`](#datanar_superuser_name), который имеет больше
возможностей, чем обычные пользователи

---

## База данных
### DATANAR_USE_FILE_DATABASE
- Использовать ли в качестве база данных sqlite3 (база данных в файле). Имеет
два возможных значения:
  - `True` - Да, использовать. Этот вариант хорошо подходит для 
    [нативной установки](native-install.md), если вы решили не устанавливать
    postgres. Если установлено это значение, то параметры ниже игнорируются
  - `False` - Нет, не использовать. Этот вариант хорош для боевой среды или
    когда применяется [контейнеризация](docker-install.md). Если установлено
    это значение, то должны быть корректно настроены параметры ниже
### DATANAR_DATABASE_NAME
- Имя базы данных. Учитывается, только если 
[`DATANAR_USE_FILE_DATABASE=True`](#datanar_use_file_database)
### DATANAR_DATABASE_USER
- Имя пользователя, который имеет все необходимые привилегии для 
базы данных [`DATANAR_DATABASE_NAME`](#datanar_database_name). Учитывается,
только если [`DATANAR_USE_FILE_DATABASE=True`](#datanar_use_file_database)
### DATANAR_DATABASE_PASSWORD
- Пароль для пользователя [`DATANAR_DATABASE_USER`](#datanar_database_user).
Учитывается, только если 
[`DATANAR_USE_FILE_DATABASE=True`](#datanar_use_file_database)
### DATANAR_DATABASE_HOST
- Хост базы данных, или же где она располагается. Принимает в целом любое 
значение, но, скорее всего, будет одно их этих двух:
  - `localhost` - Если используется [нативная установка](native-install.md)
    и postgres установлен и работает на той же машине 
  - `postgres` - Если используется [контейнеризация](docker-install.md), тогда
    во внутренней сети контейнеров БД будет доступна именно по этому хосту
  
  Учитывается, только если 
[`DATANAR_USE_FILE_DATABASE=True`](#datanar_use_file_database)
### DATANAR_DATABASE_PORT
- Порт по которому будет открыта БД на хосте, для `postgres` это обычно`5432` и
менять его не нужно. Учитывается, только если 
[`DATANAR_USE_FILE_DATABASE=True`](#datanar_use_file_database)

---

## Redis
### DATANAR_REDIS_HOST
- Хост redis, или же где он располагается. Принимает в целом любое 
значение, но, скорее всего, будет одно их этих двух:
  - `localhost` - Если используется [нативная установка](native-install.md)
    и redis установлен и работает на той же машине 
  - `redis` - Если используется [контейнеризация](docker-install.md), тогда
    во внутренней сети контейнеров БД будет доступна именно по этому хосту
### DATANAR_REDIS_PORT
- Порт по которому будет открыт redis на хосте, для `redis` это обычно `6379` и
менять его не нужно
### DATANAR_REDIS_DB
- redis по умолчанию имеет 16 логических баз данных, т.е. до 16 приложений 
могут хранить в нём свои данные без конфликтов. Принимает значение от `0` до 
`15`. По умолчанию `0`, обычно менять не нужно

---

## Certbot
### DATANAR_CERTBOT_DEBUG
- Отладочный режим, при котором в консоль выводиться дополнительная информация 
по генерации сертификатов и прочего. Принимает два возможных значения:
  - `1` - Включить отладочный режим
  - `0` - Выключить отладочный режим
  
  Учитывается, только если [`COMPOSE_PROFILES=prod`](#compose_profiles)
### DATANAR_CERTBOT_STAGING
- Режим заглушки, при котором происходит полный цикл создания и обновления 
сертификатов, за одним исключение: реальный запрос в центр сертификации не 
отправляется, вместо него генерируются заглушки. Эти сертификаты нельзя 
использовать в боевой среде, зато можно проконтролировать правильность работы
certbot. Перед генерацией действительных сертификатов следует удалить заглушки.
Принимает два возможных значения:
  - `1` - Включить режим заглушки
  - `0` - Выключить режим заглушки

  Учитывается, только если [`COMPOSE_PROFILES=prod`](#compose_profiles) 
### DATANAR_CERTBOT_EMAIL
- Почта владельца домена. Нужна для оповещения об истекании срока сертификатов,
если по какой-то причине certbot не смог автоматически их обновить
Учитывается, только если [`COMPOSE_PROFILES=prod`](#compose_profiles)

---

На этом всё! Теперь вы знаете что за что отвечает, и контроль приложения стал
чуть проще!

Вы превосходны и роскошны! ©